{% extends "cba_app/base.html" %}
{% load socialaccount %}

{% block content %}
    <div class="table-wrapper" style="max-width: 560px; margin: 0 auto;">
        <h2 style="margin-top:0;">Crear cuenta</h2>
        <p class="text-muted" style="margin-top: 6px;">Registra un usuario para ingresar al sistema.</p>

        {% if form.errors %}
            <div class="notice notice--error">Revisa los campos e inténtalo de nuevo.</div>
        {% endif %}

        <form method="post" action="{% url 'account_signup' %}" style="margin-top: 14px;">
            {% csrf_token %}

            {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
            {% endif %}

            <div style="display:grid; gap: 10px;">
                <div>
                    <label for="id_first_name" class="text-muted">Nombre</label>
                    <input id="id_first_name" name="first_name" type="text" class="cba-input" value="{{ form.first_name.value|default:'' }}" autocomplete="given-name" required>
                    {% if form.first_name.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.first_name.errors|striptags }}</div>{% endif %}
                </div>

                <div>
                    <label for="id_last_name" class="text-muted">Apellido</label>
                    <input id="id_last_name" name="last_name" type="text" class="cba-input" value="{{ form.last_name.value|default:'' }}" autocomplete="family-name" required>
                    {% if form.last_name.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.last_name.errors|striptags }}</div>{% endif %}
                </div>

                {% if form.email %}
                    <div>
                        <label for="id_email" class="text-muted">Email</label>
                        <input id="id_email" name="email" type="email" class="cba-input" value="{{ form.email.value|default:'' }}" autocomplete="email" {% if form.email.field.required %}required{% endif %}>
                        {% if form.email.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.email.errors|striptags }}</div>{% endif %}
                    </div>
                {% endif %}

                {% if form.username %}
                    <div>
                        <label for="id_username" class="text-muted">Usuario</label>
                        <input id="id_username" name="username" type="text" class="cba-input" value="{{ form.username.value|default:'' }}" autocomplete="username" {% if form.username.field.required %}required{% endif %}>
                        {% if form.username.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.username.errors|striptags }}</div>{% endif %}
                    </div>
                {% endif %}

                <div>
                    <label for="id_password1" class="text-muted">Contraseña</label>
                    <input id="id_password1" name="password1" type="password" class="cba-input" autocomplete="new-password" required>
                    {% if form.password1.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.password1.errors|striptags }}</div>{% endif %}
                </div>

                <div>
                    <label for="id_password2" class="text-muted">Confirmar contraseña</label>
                    <input id="id_password2" name="password2" type="password" class="cba-input" autocomplete="new-password" required>
                    {% if form.password2.errors %}<div class="text-muted" style="color:#b91c1c; font-size: 12px;">{{ form.password2.errors|striptags }}</div>{% endif %}
                </div>

                <label class="text-muted" style="display:flex; align-items:center; gap: 8px; font-size: 13px;">
                    <input type="checkbox" id="togglePwSignup">
                    Mostrar contraseña
                </label>
            </div>

            <div style="display:flex; gap: 10px; align-items:center; margin-top: 14px; flex-wrap: wrap;">
                <button type="submit" class="button">Crear cuenta</button>
                <a href="{% url 'account_login' %}" class="link-back" style="margin:0;">Ya tengo cuenta</a>
            </div>
        </form>

        {% get_providers as socialaccount_providers %}
        {% if socialaccount_providers %}
            <div style="margin-top: 16px;">
                <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">O registrate con</div>
                <a class="button" style="display:inline-flex; align-items:center; gap:8px;" href="{% provider_login_url 'google' process='signup' %}">
                    Continuar con Google
                </a>
            </div>
        {% endif %}

        <script>
            (function () {
                var cb = document.getElementById('togglePwSignup');
                var p1 = document.getElementById('id_password1');
                var p2 = document.getElementById('id_password2');
                if (!cb || !p1 || !p2) return;
                cb.addEventListener('change', function () {
                    var t = cb.checked ? 'text' : 'password';
                    p1.type = t;
                    p2.type = t;
                });
            })();
        </script>
    </div>
{% endblock %}
