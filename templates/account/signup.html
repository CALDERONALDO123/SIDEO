{% extends "cba_app/base.html" %}
{% load socialaccount %}

{% block body_class %}layout--auth page-auth{% endblock %}

{% block content %}
    <div class="auth-card">
        <h2 class="auth-title">Crear cuenta</h2>
        <p class="auth-subtitle">Registra un usuario para ingresar al sistema.</p>

        {% if form.errors %}
            <div class="notice notice--error">Revisa los campos e inténtalo de nuevo.</div>
        {% endif %}

        <form method="post" action="{% url 'account_signup' %}" class="auth-form">
            {% csrf_token %}

            {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
            {% endif %}

            <div class="auth-fields">
                <div>
                    <label for="id_first_name" class="auth-label">Nombre</label>
                    <input id="id_first_name" name="first_name" type="text" class="cba-input" value="{{ form.first_name.value|default:'' }}" autocomplete="given-name" required>
                    {% if form.first_name.errors %}<div class="auth-error">{{ form.first_name.errors|striptags }}</div>{% endif %}
                </div>

                <div>
                    <label for="id_last_name" class="auth-label">Apellido</label>
                    <input id="id_last_name" name="last_name" type="text" class="cba-input" value="{{ form.last_name.value|default:'' }}" autocomplete="family-name" required>
                    {% if form.last_name.errors %}<div class="auth-error">{{ form.last_name.errors|striptags }}</div>{% endif %}
                </div>

                {% if form.email %}
                    <div>
                        <label for="id_email" class="auth-label">Email</label>
                        <input id="id_email" name="email" type="email" class="cba-input" value="{{ form.email.value|default:'' }}" autocomplete="email" {% if form.email.field.required %}required{% endif %}>
                        {% if form.email.errors %}<div class="auth-error">{{ form.email.errors|striptags }}</div>{% endif %}
                    </div>
                {% endif %}

                {% if form.username %}
                    <div>
                        <label for="id_username" class="auth-label">Usuario</label>
                        <input id="id_username" name="username" type="text" class="cba-input" value="{{ form.username.value|default:'' }}" autocomplete="username" {% if form.username.field.required %}required{% endif %}>
                        {% if form.username.errors %}<div class="auth-error">{{ form.username.errors|striptags }}</div>{% endif %}
                    </div>
                {% endif %}

                <div>
                    <label for="id_password1" class="auth-label">Contraseña</label>
                    <input id="id_password1" name="password1" type="password" class="cba-input" autocomplete="new-password" required>
                    {% if form.password1.errors %}<div class="auth-error">{{ form.password1.errors|striptags }}</div>{% endif %}
                </div>

                <div>
                    <label for="id_password2" class="auth-label">Confirmar contraseña</label>
                    <input id="id_password2" name="password2" type="password" class="cba-input" autocomplete="new-password" required>
                    {% if form.password2.errors %}<div class="auth-error">{{ form.password2.errors|striptags }}</div>{% endif %}
                </div>

                <label class="auth-checkbox">
                    <input type="checkbox" id="togglePwSignup">
                    Mostrar contraseña
                </label>
            </div>

            <div class="auth-actions">
                <button type="submit" class="button">Crear cuenta</button>
                <a href="{% url 'account_login' %}" class="link-back" style="margin:0;">Ya tengo cuenta</a>
            </div>
        </form>

        {% get_providers as socialaccount_providers %}
        {% if socialaccount_providers %}
            <div class="auth-secondary">
                <div class="auth-secondary__title">O registrate con</div>
                <a class="button" style="display:inline-flex; align-items:center; gap:8px;" href="{% provider_login_url 'google' process='signup' %}">
                    Continuar con Google
                </a>
            </div>
        {% endif %}

        <script>
            (function () {
                var cb = document.getElementById('togglePwSignup');
                var p1 = document.getElementById('id_password1');
                var p2 = document.getElementById('id_password2');
                if (!cb || !p1 || !p2) return;
                cb.addEventListener('change', function () {
                    var t = cb.checked ? 'text' : 'password';
                    p1.type = t;
                    p2.type = t;
                });
            })();
        </script>
    </div>
{% endblock %}
