{% extends "cba_app/base.html" %}
{% load socialaccount %}

{% block content %}
    <div class="table-wrapper" style="max-width: 520px; margin: 0 auto;">
        <h2 style="margin-top:0;">Iniciar sesión</h2>
        <p class="text-muted" style="margin-top: 6px;">Accede al sistema para continuar.</p>

        {% if form.errors %}
            <div class="notice notice--error">Revisa tus credenciales e inténtalo de nuevo.</div>
        {% endif %}

        <form method="post" action="{% url 'account_login' %}" style="margin-top: 14px;">
            {% csrf_token %}

            {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
            {% endif %}

            <div style="display:grid; gap: 10px;">
                <div>
                    <label for="id_login" class="text-muted">Usuario o email</label>
                    <input id="id_login" name="login" type="text" class="cba-input" autocomplete="username" required>
                </div>

                <div>
                    <label for="id_password" class="text-muted">Contraseña</label>
                    <input id="id_password" name="password" type="password" class="cba-input" autocomplete="current-password" required>
                </div>

                <label class="text-muted" style="display:flex; align-items:center; gap: 8px; font-size: 13px;">
                    <input type="checkbox" id="togglePwLogin">
                    Mostrar contraseña
                </label>
            </div>

            <div style="display:flex; gap: 10px; align-items:center; margin-top: 14px; flex-wrap: wrap;">
                <button type="submit" class="button">Ingresar</button>
                <a href="{% url 'account_signup' %}" class="link-back" style="margin:0;">Crear cuenta</a>
                <a href="{% url 'account_reset_password' %}" class="link-back" style="margin:0;">Olvidé mi contraseña</a>
            </div>
        </form>

        {% get_providers as socialaccount_providers %}
        {% if socialaccount_providers %}
            <div style="margin-top: 16px;">
                <div class="text-muted" style="font-size: 13px; margin-bottom: 8px;">O ingresá con</div>
                <a class="button" style="display:inline-flex; align-items:center; gap:8px;" href="{% provider_login_url 'google' process='login' %}">
                    Continuar con Google
                </a>
            </div>
        {% endif %}

        <script>
            (function () {
                var cb = document.getElementById('togglePwLogin');
                var pw = document.getElementById('id_password');
                if (!cb || !pw) return;
                cb.addEventListener('change', function () {
                    pw.type = cb.checked ? 'text' : 'password';
                });
            })();
        </script>
    </div>
{% endblock %}
