{% extends "cba_app/base.html" %}
{% load socialaccount %}

{% block body_class %}layout--auth page-auth{% endblock %}

{% block content %}
    <div class="auth-card">
        <h2 class="auth-title">Iniciar sesión</h2>
        <p class="auth-subtitle">Accede al sistema para continuar.</p>

        {% if form.errors %}
            <div class="notice notice--error">Revisa tus credenciales e inténtalo de nuevo.</div>
        {% endif %}

        <form method="post" action="{% url 'account_login' %}" class="auth-form">
            {% csrf_token %}

            {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
            {% endif %}

            <div class="auth-fields">
                <div>
                    <label for="id_login" class="auth-label">Usuario o email</label>
                    <input id="id_login" name="login" type="text" class="cba-input" autocomplete="username" required>
                </div>

                <div>
                    <label for="id_password" class="auth-label">Contraseña</label>
                    <input id="id_password" name="password" type="password" class="cba-input" autocomplete="current-password" required>
                </div>

                <label class="auth-checkbox">
                    <input type="checkbox" id="togglePwLogin">
                    Mostrar contraseña
                </label>
            </div>

            <div class="auth-actions">
                <button type="submit" class="button">Ingresar</button>
                <a href="{% url 'account_signup' %}" class="link-back" style="margin:0;">Crear cuenta</a>
                <a href="{% url 'account_reset_password' %}" class="link-back" style="margin:0;">Olvidé mi contraseña</a>
            </div>
        </form>

        {% get_providers as socialaccount_providers %}
        {% if socialaccount_providers %}
            <div class="auth-secondary">
                <div class="auth-secondary__title">O ingresá con</div>
                <a class="button" style="display:inline-flex; align-items:center; gap:8px;" href="{% provider_login_url 'google' process='login' %}">
                    Continuar con Google
                </a>
            </div>
        {% endif %}

        <script>
            (function () {
                var cb = document.getElementById('togglePwLogin');
                var pw = document.getElementById('id_password');
                if (!cb || !pw) return;
                cb.addEventListener('change', function () {
                    pw.type = cb.checked ? 'text' : 'password';
                });
            })();
        </script>
    </div>
{% endblock %}
